import{i as ee,k as te,j as a,l as ae,m as T,n as re,o as I,D as E,O as S}from"./ui-DtsVk1ZT.js";import{l as se}from"./cashfree-B7mpbZSe.js";import{b as z,c as g,B as p,s as f}from"./supabase-DlqSYPSw.js";import{b as h,r as i}from"./vendor-DTE74Mn0.js";import{N as ne,A as oe,a as le,b as ie}from"./Navbar-DZYycAMd.js";import{a as ce,b as de,u as w}from"./index-D_CGr1NW.js";import{L as me}from"./loader-circle-B5g_8GOJ.js";import"./supabase-BBSrB3Yz.js";import"./check-C9iSlceZ.js";/**
 * @license lucide-react v0.441.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=z("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.441.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fe=z("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);var R={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},k=h.createContext&&h.createContext(R),he=["attr","size","title"];function pe(e,r){if(e==null)return{};var t=ge(e,r),n,c;if(Object.getOwnPropertySymbols){var m=Object.getOwnPropertySymbols(e);for(c=0;c<m.length;c++)n=m[c],!(r.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(t[n]=e[n])}return t}function ge(e,r){if(e==null)return{};var t={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(r.indexOf(n)>=0)continue;t[n]=e[n]}return t}function y(){return y=Object.assign?Object.assign.bind():function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e},y.apply(this,arguments)}function C(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),t.push.apply(t,n)}return t}function b(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?C(Object(t),!0).forEach(function(n){xe(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):C(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function xe(e,r,t){return r=ye(r),r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function ye(e){var r=be(e,"string");return typeof r=="symbol"?r:r+""}function be(e,r){if(typeof e!="object"||!e)return e;var t=e[Symbol.toPrimitive];if(t!==void 0){var n=t.call(e,r);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(e)}function A(e){return e&&e.map((r,t)=>h.createElement(r.tag,b({key:t},r.attr),A(r.child)))}function N(e){return r=>h.createElement(je,y({attr:b({},e.attr)},r),A(e.child))}function je(e){var r=t=>{var{attr:n,size:c,title:m}=e,j=pe(e,he),x=c||t.size||"1em",d;return t.className&&(d=t.className),e.className&&(d=(d?d+" ":"")+e.className),h.createElement("svg",y({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},t.attr,n,j,{className:d,style:b(b({color:e.color||t.color},t.style),e.style),height:x,width:x,xmlns:"http://www.w3.org/2000/svg"}),m&&h.createElement("title",null,m),e.children)};return k!==void 0?h.createElement(k.Consumer,null,t=>r(t)):r(R)}function ve(e){return N({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{fill:"none",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"32",d:"M320 176v-40a40 40 0 0 0-40-40H88a40 40 0 0 0-40 40v240a40 40 0 0 0 40 40h192a40 40 0 0 0 40-40v-40m64-160 80 80-80 80m-193-80h273"},child:[]}]})(e)}function we(e){return N({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M268 416h24a12 12 0 0 0 12-12V188a12 12 0 0 0-12-12h-24a12 12 0 0 0-12 12v216a12 12 0 0 0 12 12zM432 80h-82.41l-34-56.7A48 48 0 0 0 274.41 0H173.59a48 48 0 0 0-41.16 23.3L98.41 80H16A16 16 0 0 0 0 96v16a16 16 0 0 0 16 16h16v336a48 48 0 0 0 48 48h288a48 48 0 0 0 48-48V128h16a16 16 0 0 0 16-16V96a16 16 0 0 0-16-16zM171.84 50.91A6 6 0 0 1 177 48h94a6 6 0 0 1 5.15 2.91L293.61 80H154.39zM368 464H80V128h288zm-212-48h24a12 12 0 0 0 12-12V188a12 12 0 0 0-12-12h-24a12 12 0 0 0-12 12v216a12 12 0 0 0 12 12z"},child:[]}]})(e)}const Ne=ee,De=te,Oe=ae,L=i.forwardRef(({className:e,...r},t)=>a.jsx(S,{ref:t,className:g("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...r}));L.displayName=S.displayName;const B=i.forwardRef(({className:e,children:r,...t},n)=>a.jsxs(Oe,{children:[a.jsx(L,{}),a.jsxs(T,{ref:n,className:g("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...t,children:[r,a.jsxs(re,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[a.jsx(fe,{className:"h-4 w-4"}),a.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));B.displayName=T.displayName;const H=({className:e,...r})=>a.jsx("div",{className:g("flex flex-col space-y-1.5 text-center sm:text-left",e),...r});H.displayName="DialogHeader";const M=({className:e,...r})=>a.jsx("div",{className:g("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...r});M.displayName="DialogFooter";const q=i.forwardRef(({className:e,...r},t)=>a.jsx(I,{ref:t,className:g("text-lg font-semibold leading-none tracking-tight",e),...r}));q.displayName=I.displayName;const V=i.forwardRef(({className:e,...r},t)=>a.jsx(E,{ref:t,className:g("text-sm text-muted-foreground",e),...r}));V.displayName=E.displayName;function _e(e){return N({attr:{viewBox:"0 0 16 16",fill:"currentColor"},child:[{tag:"path",attr:{fillRule:"evenodd",clipRule:"evenodd",d:"M12.75 8a4.5 4.5 0 0 1-8.61 1.834l-1.391.565A6.001 6.001 0 0 0 14.25 8 6 6 0 0 0 3.5 4.334V2.5H2v4l.75.75h3.5v-1.5H4.352A4.5 4.5 0 0 1 12.75 8z"},child:[]}]})(e)}const Ae=()=>{const e=i.useRef(null),{teamId:r}=ce(),[t,n]=i.useState(null),[c,m]=i.useState(!0),[j,x]=i.useState(void 0),[d,U]=i.useState(!1),[F,W]=i.useState(null),D=de();i.useEffect(()=>{m(!0);const s=async()=>{try{const{data:{user:o},error:u}=await f.auth.getUser();if(u){console.error(u),window.location.href="/login";return}const{data:v,error:O}=await f.from("users").select("*").eq("user_id",o==null?void 0:o.id).single();if(O){console.error(O);return}console.log(o),W(o),x(v==null?void 0:v.name);const{data:_,error:P}=await f.from("teams").select(`
          *,
          members: users(*)
        `).eq("team_id",r).single();if(P){console.error("Error fetching team:",P);return}_.leader_user_id===(o==null?void 0:o.id)&&U(!0),n(_),m(!1)}catch(o){console.error(o),m(!1)}},l=async()=>{const{data:o,error:u}=await f.from("teams").select("payment_status").eq("team_id",r).single();if(u){console.error(u);return}return{paymentData:o}};s(),l()},[r]);const K=async()=>{try{console.log("Initializing Cashfree SDK..."),e.current=await se({mode:"production"}),console.log("Cashfree SDK initialized successfully");const s="https://backend.transfinitte.org/api/checkout";console.log("Calling backend API:",s),console.log("Environment variable VITE_PROD_URL_BACKEND:","https://backend.transfinitte.org");const l={userId:r,teamName:"team-name",teamId:r};console.log("Request body:",l);const o=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)});if(console.log("Backend API response status:",o.status),!o.ok)throw new Error(`HTTP error! status: ${o.status}`);const u=await o.json();return console.log("Backend API response data:",u),u}catch(s){throw console.error("Error fetching order:",s),s}},$=async()=>{var l;if(console.log("Handle pay called"),console.log("Team members count:",(l=t==null?void 0:t.members)==null?void 0:l.length),console.log("Team data:",t),t!=null&&t.members.length&&t.members.length<4){console.log("❌ Payment blocked: Team has less than 4 members"),w("Whoops!",{description:"You need at least 4 members in your team to submit payment."});return}console.log("✅ Team has enough members, proceeding with payment...");const s=await K();s?await G(s):console.error("❌ Failed to fetch order from backend")},G=async s=>{if(!e.current){console.error("Cashfree SDK not initialized yet");return}if(!s.payment_session_id){console.error("Order not ready yet");return}const l={paymentSessionId:s.payment_session_id,redirect:!0,appearance:{width:"425px",height:"700px"}};try{const o=await e.current.checkout(l);o.error&&console.error("Payment error:",o.error),o.redirect&&console.log("Payment will be redirected"),o.paymentDetails&&(console.log("Payment completed:",o.paymentDetails),console.log(s),console.log("Payment completed:",o.paymentDetails.paymentMessage))}catch(o){console.error("Checkout failed:",o)}},X=async()=>{let s,l=!1;for(;!l;){s=Math.floor(1e5+Math.random()*9e5).toString();const{data:o}=await f.from("teams").select("team_id").eq("team_id",s);(!o||o.length===0)&&(l=!0)}return s},J=async()=>{const s=await X();if(t&&d){const{error:l}=await f.from("teams").update({team_id:s}).eq("team_id",t.team_id);if(l){console.error("Error generating new team ID: ",l);return}setTimeout(()=>{window.location.href=`/team/${s}`},1e3),window.location.href=`/team/${s}`}},Y=async()=>{if(t){const{error:s}=await f.from("users").update({team_id:null}).eq("user_id",F.id);if(s){console.error("Error leaving team: ",s);return}D("/")}},Q=async()=>{if(d&&t){const{error:s}=await f.from("teams").delete().eq("team_id",t.team_id);if(s){console.error("Error discarding team: ",s);return}D("/")}},Z=s=>{navigator.clipboard.writeText(s).then(()=>{w("Copied!",{description:"Team ID copied to clipboard."})},l=>{console.error("Could not copy text: ",l),w("Whoops!",{description:"Could not copy team ID to clipboard."})})};return c?a.jsxs("div",{className:"flex flex-col items-center justify-center min-h-screen bg-black text-white",children:[a.jsx(me,{className:"w-12 h-12 animate-spin mb-4"}),a.jsx("p",{className:"text-xl"})]}):t?(console.log("Team: ",t),a.jsxs("div",{className:"flex flex-col min-h-screen bg-black text-white",children:[a.jsx(ne,{userName:j}),a.jsxs("div",{className:"flex flex-col justify-between h-full flex-grow",children:[a.jsxs("div",{className:"flex-grow flex flex-col lg:flex-row-reverse lg:justify-between items-center lg:items-start px-4 md:px-6 pt-8",children:[a.jsxs("div",{className:"lg:w-[40%] md:w-1/2 w-full",style:{backgroundImage:"url('/team-card2.svg')",backgroundSize:"cover",backgroundRepeat:"no-repeat",aspectRatio:"343 / 216",position:"relative"},children:[a.jsx("h2",{className:"text-[1.4em] font-semibold absolute bottom-0 left-0 p-[1em] md:p-[1.6em]",children:t.name}),a.jsx("div",{className:"absolute bottom-0 right-0 p-6 pb-4",children:(t.payment_status==="Pending"||t.payment_status==="Failed")&&a.jsx(p,{className:"bg-white text-black rounded-[120px] font-bold hover:bg-gray-100 transition duration-300 flex items-center justify-center gap-2",onClick:$,children:a.jsx("img",{src:"/pay.svg"})})})]}),a.jsx("div",{className:"flex",children:a.jsxs("div",{className:"lg:w-[60%] h-full lg:pr-8 ",children:[a.jsxs("div",{className:"w-full h-full pt-3 mt-4 flex flex-col",children:[a.jsx("h1",{className:"font-spacegrotesk text-3xl lg:text-5xl font-medium",children:"Dashboard"}),a.jsxs("span",{className:"text-neutral-500 pt-2",children:["Invite your teammates by sharing the team ID."," "]})]}),a.jsx("div",{className:"h-full w-full space-y-6 pt-8",children:a.jsx("div",{className:"space-y-4 h-full w-full py-4 pb-8",children:a.jsxs("div",{className:"pb-8 w-full h-full flex flex-col justify-between",children:[a.jsx("ul",{className:"flex flex-wrap gap-6 w-full",children:t.members&&t.members.sort(s=>s.user_id===t.leader_user_id?-1:1).map((s,l)=>a.jsxs("li",{className:"flex items-center space-x-2 w-full lg:bg-neutral-900 lg:rounded-lg lg:border-[1px] lg:border-neutral-600 lg:p-4 relative",children:[a.jsxs(oe,{children:[a.jsx(le,{src:s.pfp,height:10,width:10}),a.jsx(ie,{className:"text-black",children:s.name.charAt(0).toUpperCase()})]}),a.jsxs("div",{className:"flex flex-col",children:[a.jsxs("span",{className:"text-white text-[16px]",children:[s.name," ",l===0&&"(Lead)"]}),a.jsx("span",{className:"text-white text-[12px] opacity-60",children:s.roll_number})]})]},l))}),a.jsx("div",{children:d?a.jsxs(Ne,{children:[a.jsx(De,{asChild:!0,children:a.jsxs(p,{variant:"outline",className:"m-5 text-black hover:bg-neutral-400",children:["Discard Team ",a.jsx(we,{className:"text-[16px] ml-2"})]})}),a.jsxs(B,{className:"sm:max-w-[425px]",children:[a.jsxs(H,{children:[a.jsx(q,{children:"Discard Team"}),a.jsx(V,{children:"Discarding this team will remove all members from the team and erase its traces from our servers. Are you sure you want to discard this team?"})]}),a.jsx(M,{children:a.jsx(p,{type:"submit",onClick:Q,children:"Confirm"})})]})]}):a.jsxs(p,{variant:"outline",className:"m-5 text-black hover:bg-neutral-400",onClick:Y,children:["Leave Team ",a.jsx(ve,{className:"text-xl ml-2"})]})})]})})})]})})]}),a.jsxs("div",{className:"border-t-[1px] p-4 px-8 border-neutral-800",children:[a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsxs("span",{className:"font-semibold w-full",children:["Payment Status:"," "]}),a.jsx("span",{className:"font-semibold w-full text-yellow-500 text-right",children:t.payment_status})]}),a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"font-semibold",children:"Team ID:"}),a.jsxs("div",{className:"flex items-center",children:[a.jsx("span",{children:t.team_id}),a.jsx(p,{onClick:()=>Z(t.team_id),className:"ml-2 p-1 bg-transparent hover:bg-gray-700 rounded-full",children:a.jsx(ue,{className:"h-4 w-4"})}),d&&a.jsx(p,{onClick:J,className:"ml-2 p-1 bg-transparent hover:bg-gray-700 rounded-full",children:a.jsx(_e,{className:"h-4 w-4"})})]})]})]})]})]})):a.jsx("div",{className:"flex justify-center items-center h-screen text-white",children:"Team not found"})};export{Ae as default};
